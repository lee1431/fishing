<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vanilla To-Do Advisor</title>
  <style>
    :root { --gap:12px; --bg:#0e0f13; --card:#151821; --ink:#e8ecf1; --muted:#9aa3ad; --accent:#7cc1ff; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:var(--ink); }
    header { padding:20px; border-bottom:1px solid #222833; display:flex; gap:var(--gap); align-items:center; justify-content:space-between; }
    h1 { margin:0; font-size:18px; letter-spacing:.4px; }
    main { max-width:880px; margin:0 auto; padding:20px; display:grid; gap:var(--gap); }
    .row { display:flex; gap:var(--gap); flex-wrap:wrap; }
    .card { background:var(--card); border:1px solid #1d2230; border-radius:12px; padding:16px; }
    .grow { flex:1 1 360px; }
    label { display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input, select, button, textarea { width:100%; background:#0f121b; color:var(--ink); border:1px solid #23293a; border-radius:10px; padding:12px; }
    button { cursor:pointer; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:var(--gap); }
    .tasks { display:grid; gap:10px; }
    .task { display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; border:1px dashed #2a3144; padding:12px; border-radius:10px; }
    .task h4 { margin:0 0 6px 0; font-size:14px; }
    .meta { font-size:12px; color:var(--muted); display:flex; gap:10px; flex-wrap:wrap; }
    .chips { display:flex; gap:6px; flex-wrap:wrap; }
    .chip { font-size:11px; padding:4px 8px; border-radius:999px; background:#1b2232; border:1px solid #2a3144; }
    .actions { display:flex; gap:8px; }
    .pill { padding:8px 12px; border-radius:999px; border:1px solid #2a3144; background:#121625; }
    .accent { border-color:#2b82ff; }
    .muted { color:var(--muted); }
    .hint { font-size:12px; color:var(--muted); }
    .title-input { font-weight:600; }
    .today-list .task { border-style:solid; }
    .empty { color:var(--muted); text-align:center; padding:12px; }
  </style>
</head>
<body>
  <header>
    <h1>Vanilla To-Do Advisor ğŸ¦</h1>
    <div class="hint">ìë™ ì¶”ì²œ Â· ìœ ë™ ì¬ë°°ì¹˜ Â· ì˜¤í”„ë¼ì¸ ì €ì¥</div>
  </header>

  <main>
    <!-- ìƒíƒœ/ê¸°ë¶„ -->
    <section class="card grow">
      <h3 style="margin:0 0 10px">ì˜¤ëŠ˜ ì»¨ë””ì…˜</h3>
      <div class="grid">
        <div>
          <label>ê¸°ë¶„(Mood)</label>
          <select id="mood">
            <option value="low">ë‚®ìŒ</option>
            <option value="mid" selected>ë³´í†µ</option>
            <option value="high">ì¢‹ìŒ</option>
          </select>
        </div>
        <div>
          <label>ì—ë„ˆì§€(Energy)</label>
          <select id="energy">
            <option value="low">ë‚®ìŒ</option>
            <option value="mid" selected>ë³´í†µ</option>
            <option value="high">ë†’ìŒ</option>
          </select>
        </div>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
        <button class="pill accent" id="recompute">ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë‹¤ì‹œ ë½‘ê¸°</button>
        <span class="hint">ê¸°ë¶„/ì—ë„ˆì§€ ë°”ê¾¸ê³  ëˆ„ë¥´ë©´ ì¶”ì²œì´ ì¬ê³„ì‚°ë¼ìš”.</span>
      </div>
    </section>

    <!-- ì…ë ¥ -->
    <section class="card grow">
      <h3 style="margin:0 0 10px">ìƒˆ ì‘ì—… ì¶”ê°€</h3>
      <div class="grid">
        <div>
          <label>ì œëª©</label>
          <input id="title" class="title-input" placeholder="ì˜ˆ: ì„¸ê¸ˆ ì •ë¦¬, ê¸€ 1ë‹¨ë½ ì“°ê¸°" />
        </div>
        <div>
          <label>ë§ˆê°(ì„ íƒ)</label>
          <input id="due" type="date" />
        </div>
      </div>
      <div class="grid" style="margin-top:12px">
        <div>
          <label>ìš°ì„ ìˆœìœ„</label>
          <select id="priority">
            <option value="3">ë‚®ìŒ</option>
            <option value="2" selected>ë³´í†µ</option>
            <option value="1">ë†’ìŒ</option>
          </select>
        </div>
        <div>
          <label>í•„ìš” ì—ë„ˆì§€</label>
          <select id="effort">
            <option value="low">ê°€ë²¼ì›€</option>
            <option value="mid" selected>ë³´í†µ</option>
            <option value="high">ë¹¡ì…ˆ</option>
          </select>
        </div>
      </div>
      <div style="margin-top:12px">
        <label>ë©”ëª¨(ì„ íƒ)</label>
        <textarea id="note" rows="2" placeholder="ê°„ë‹¨í•œ ì„¤ëª…â€¦"></textarea>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
        <button class="pill accent" id="add">ì¶”ê°€</button>
        <button class="pill" id="clearAll">ì „ì²´ ì‚­ì œ</button>
        <span class="hint">ëª¨ë“  ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤(localStorage).</span>
      </div>
    </section>

    <!-- ì¶”ì²œ/ì˜¤ëŠ˜ -->
    <section class="card grow">
      <h3 style="margin:0 0 10px">ğŸ§­ ì˜¤ëŠ˜ì˜ ì¶”ì²œ</h3>
      <div id="today" class="tasks today-list"></div>
    </section>

    <!-- ì „ì²´ ëª©ë¡ -->
    <section class="card grow">
      <h3 style="margin:0 0 10px">ğŸ“š ì „ì²´ ì‘ì—…</h3>
      <div id="list" class="tasks"></div>
    </section>
  </main>

  <script>
    // --- ì‘ì€ ìœ í‹¸ ---
    const $ = sel => document.querySelector(sel);
    const uid = () => Math.random().toString(36).slice(2,9);
    const load = (k, d) => { try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d; } };
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const todayStr = () => new Date().toISOString().slice(0,10);

    // --- ìƒíƒœ ---
    let tasks = load('vx_tasks', []);
    let state = load('vx_state', { mood:'mid', energy:'mid', lastRecommended:todayStr(), picks:[] });

    // --- DOM refs ---
    const refs = {
      mood: $('#mood'), energy: $('#energy'),
      title: $('#title'), due: $('#due'),
      priority: $('#priority'), effort: $('#effort'), note: $('#note'),
      add: $('#add'), clearAll: $('#clearAll'), recompute: $('#recompute'),
      list: $('#list'), today: $('#today')
    };

    // --- ë Œë” ---
    function render() {
      // ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë Œë”
      const picks = state.picks
        .map(id => tasks.find(t => t.id === id))
        .filter(Boolean);
      refs.today.innerHTML = picks.length ? '' : '<div class="empty">ì¶”ì²œì´ ë¹„ì—ˆì–´ìš”. ì»¨ë””ì…˜ ë§ì¶° ì¬ì¶”ì²œí•´ë³´ì„¸ìš”.</div>';
      picks.forEach(t => refs.today.appendChild(taskView(t, true)));

      // ì „ì²´ ëª©ë¡ ë Œë” (ë¯¸ì™„ë£Œ ìš°ì„ , ì™„ë£ŒëŠ” ë§¨ ì•„ë˜)
      const open = tasks.filter(t => !t.done);
      const done = tasks.filter(t => t.done);
      // ê°„ë‹¨ ì •ë ¬: ë§ˆê° ì„ë°• â†‘, ìš°ì„ ìˆœìœ„ ë†’ìŒ â†‘
      open.sort((a,b) => (scoreForSort(b) - scoreForSort(a)));
      refs.list.innerHTML = '';
      [...open, ...done].forEach(t => refs.list.appendChild(taskView(t, false)));
    }

    function scoreForSort(t) {
      const dueFactor = t.due ? (1 / (1 + daysFromToday(t.due))) : 0.25; // ê°€ê¹Œìš¸ìˆ˜ë¡ í¼
      const prio = (4 - Number(t.priority)); // 1(ë†’ìŒ) -> 3ì , 3(ë‚®ìŒ) -> 1ì 
      const donePenalty = t.done ? -100 : 0;
      return dueFactor * 3 + prio + donePenalty;
    }

    function daysFromToday(dateStr) {
      const a = new Date(dateStr); a.setHours(0,0,0,0);
      const b = new Date(); b.setHours(0,0,0,0);
      return Math.round((a - b) / 86400000);
    }

    function chip(txt){ const s=document.createElement('span'); s.className='chip'; s.textContent=txt; return s; }

    function taskView(t, compact=false) {
      const el = document.createElement('div');
      el.className = 'task';
      const left = document.createElement('div');
      const right = document.createElement('div');
      right.className = 'actions';

      const h4 = document.createElement('h4');
      h4.textContent = t.title + (t.done ? ' âœ…' : '');
      left.appendChild(h4);

      const meta = document.createElement('div'); meta.className='meta';
      const chips = document.createElement('div'); chips.className='chips';
      chips.appendChild(chip('ìš°ì„ ìˆœìœ„ ' + (t.priority === '1' ? 'ë†’ìŒ' : t.priority === '2' ? 'ë³´í†µ' : 'ë‚®ìŒ')));
      chips.appendChild(chip('í•„ìš”ì—ë„ˆì§€ ' + t.effort));
      if (t.due) chips.appendChild(chip('ë§ˆê° ' + t.due + (daysFromToday(t.due)<0?' (ì§€ë‚¨)':'')));
      meta.appendChild(chips);
      if (t.note) { const n=document.createElement('div'); n.className='muted'; n.textContent=t.note; meta.appendChild(n); }
      left.appendChild(meta);

      // actions
      const btnDone = document.createElement('button');
      btnDone.className='pill';
      btnDone.textContent = t.done ? 'ë³µêµ¬' : 'ì™„ë£Œ';
      btnDone.onclick = () => { t.done = !t.done; persist(); };

      const btnSnooze = document.createElement('button');
      btnSnooze.className='pill';
      btnSnooze.textContent = 'ìŠ¤ëˆ„ì¦ˆ(ë‚´ì¼)';
      btnSnooze.onclick = () => { t.due = shiftDate(t.due ?? todayStr(), 1); persist(); };

      const btnDel = document.createElement('button');
      btnDel.className='pill';
      btnDel.textContent = 'ì‚­ì œ';
      btnDel.onclick = () => { tasks = tasks.filter(x => x.id !== t.id); removeFromPicks(t.id); persist(); };

      right.append(btnDone, btnSnooze, btnDel);

      el.append(left, right);
      return el;
    }

    function shiftDate(dateStr, deltaDays){
      const d = new Date(dateStr); d.setDate(d.getDate()+deltaDays);
      return d.toISOString().slice(0,10);
    }

    // --- ì¶”ì²œ ë¡œì§ ---
    function recommendToday(count=3) {
      const m = refs.mood.value;
      const e = refs.energy.value;
      state.mood = m; state.energy = e;

      // í•„í„°: ì™„ë£Œ ì œì™¸
      const pool = tasks.filter(t => !t.done);

      // ì ìˆ˜: ìš°ì„ ìˆœìœ„, ë§ˆê° ì„ë°•, ì»¨ë””ì…˜-ì‘ì—… ë§¤ì¹­
      const scored = pool.map(t => {
        let s = 0;

        // ìš°ì„ ìˆœìœ„ ê°€ì¤‘
        s += (t.priority === '1' ? 3 : t.priority === '2' ? 2 : 1) * 2;

        // ë§ˆê° ì„ë°• ê°€ì¤‘ (ê°€ê¹Œìš¸ìˆ˜ë¡ â†‘)
        if (t.due) {
          const d = daysFromToday(t.due);
          s += (d <= 0 ? 5 : d <= 1 ? 4 : d <= 3 ? 3 : d <= 7 ? 2 : 1);
        } else {
          s += 1;
        }

        // ì»¨ë””ì…˜-ì—ë„ˆì§€ ë§¤ì¹­
        const eff = t.effort; // low/mid/high
        const table = {
          low:  { low:3, mid:1, high:0 },
          mid:  { low:2, mid:3, high:1 },
          high: { low:1, mid:2, high:3 }
        };
        s += table[e][eff];

        // ê¸°ë¶„ ë³´ì •(ì¢‹ìŒì¼ìˆ˜ë¡ ë‚œì´ë„ í—ˆìš© â†‘)
        const moodBoost = { low: {low:1,mid:0,high:-1}, mid:{low:1,mid:1,high:0}, high:{low:0,mid:1,high:2} };
        s += moodBoost[m][eff];

        return { t, s };
      });

      scored.sort((a,b)=>b.s-a.s);
      state.picks = scored.slice(0,count).map(x => x.t.id);
      state.lastRecommended = todayStr();
      persist();
    }

    function removeFromPicks(id){
      state.picks = state.picks.filter(x => x !== id);
    }

    // --- ì´ë²¤íŠ¸ ---
    refs.add.onclick = () => {
      const title = refs.title.value.trim();
      if (!title) return;
      const t = {
        id: uid(),
        title,
        due: refs.due.value || '',
        priority: refs.priority.value,
        effort: refs.effort.value,
        note: refs.note.value.trim(),
        done: false,
        createdAt: Date.now()
      };
      tasks.push(t);
      refs.title.value = ''; refs.note.value=''; refs.due.value='';
      persist();
      recommendToday(); // ìƒˆ ì‘ì—… ë°˜ì˜
    };

    refs.clearAll.onclick = () => {
      if (!confirm('ì •ë§ ëª¨ë“  ì‘ì—…ì„ ì‚­ì œí• ê¹Œìš”?')) return;
      tasks = [];
      state.picks = [];
      persist();
    };

    refs.recompute.onclick = () => { recommendToday(); };

    refs.mood.onchange = () => { state.mood = refs.mood.value; save('vx_state', state); };
    refs.energy.onchange = () => { state.energy = refs.energy.value; save('vx_state', state); };

    // --- ì €ì¥/ë³µêµ¬ ---
    function persist(){
      save('vx_tasks', tasks);
      save('vx_state', state);
      render();
    }

    function restore() {
      refs.mood.value = state.mood;
      refs.energy.value = state.energy;

      // í•˜ë£¨ì— í•œ ë²ˆ ìë™ ì¶”ì²œ(ì˜¤ëŠ˜ ì²˜ìŒ ì—´ë©´)
      if (state.lastRecommended !== todayStr()) recommendToday();
      render();
    }

    restore();
  </script>
</body>
</html>