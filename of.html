<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#B57CFF" />
<title>STANCE ‚Äî One-line Feed</title>

<style>
  :root{
    --bg0:#070A10;
    --bg1:#0B1020;
    --ink:#EAF0FF;
    --ink2:#C9D3EE;
    --muted:#9AA7C7;
    --line:rgba(255,255,255,.12);

    --glass:rgba(15,18,30,.46);
    --shadow: 0 28px 90px rgba(0,0,0,.55);
    --shadow2: 0 10px 30px rgba(0,0,0,.35);

    --accent:#B57CFF;
    --accent2:#61D0FF;
    --ok:#7CFFA7;

    --radius:18px;
  }

  *{ box-sizing:border-box; }
  html,body{ height:100%; }
  body{
    margin:0;
    color:var(--ink);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
    background:
      radial-gradient(1200px 700px at 20% 10%, rgba(181,124,255,.22), transparent 60%),
      radial-gradient(900px 600px at 80% 20%, rgba(97,208,255,.18), transparent 55%),
      radial-gradient(900px 600px at 60% 90%, rgba(124,255,167,.10), transparent 60%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    overflow-x:hidden;
  }

  body::before{
    content:"";
    position:fixed; inset:0;
    background:
      repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.030) 0px,
        rgba(255,255,255,.030) 1px,
        rgba(0,0,0,0) 3px,
        rgba(0,0,0,0) 6px
      );
    mix-blend-mode: overlay;
    opacity:.25;
    pointer-events:none;
  }
  body::after{
    content:"";
    position:fixed; inset:-40px;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
    opacity:.12;
    pointer-events:none;
  }

  .wrap{
    width:min(1180px, 94vw);
    margin:0 auto;
    padding:36px 0 64px;
  }

  /* ===== top brand ===== */
  .brand{
    display:flex;
    align-items:flex-start;
    gap:12px;
    margin-bottom:16px;
    user-select:none;
  }
  .logo{
    width:34px; height:34px;
    border-radius:12px;
    background:
      radial-gradient(12px 12px at 30% 30%, rgba(255,255,255,.55), transparent 55%),
      linear-gradient(135deg, rgba(181,124,255,.9), rgba(97,208,255,.7));
    box-shadow: 0 12px 28px rgba(181,124,255,.18);
  }
  .brand h1{
    margin:0;
    font-size:22px;
    letter-spacing:-.4px;
    line-height:1.1;
    text-shadow: 0 2px 18px rgba(0,0,0,.55);
  }
  .brand p{
    margin:6px 0 0;
    color:var(--muted);
    font-size:13px;
  }

  /* ===== layout: feed left, chat right ===== */
  .grid{
    display:grid;
    grid-template-columns: 1fr 360px;
    gap:14px;
    align-items:start;
  }
  @media (max-width: 980px){
    .grid{ grid-template-columns: 1fr; }
  }

  /* ===== glass panel ===== */
  .panel{
    position:relative;
    border-radius: var(--radius);
    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)) , var(--glass);
    border:1px solid rgba(255,255,255,.12);
    box-shadow: var(--shadow);
    overflow:hidden;
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
  }
  .panel::before{
    content:"";
    position:absolute; inset:0;
    background:
      radial-gradient(900px 200px at 30% 0%, rgba(181,124,255,.20), transparent 60%),
      radial-gradient(800px 240px at 90% 10%, rgba(97,208,255,.14), transparent 62%),
      linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,0));
    opacity:.7;
    pointer-events:none;
  }

  /* ===== header bar ===== */
  .bar{
    position:relative;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 16px;
    border-bottom:1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.10);
  }
  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:7px 10px;
    border-radius:999px;
    font-size:12px;
    color:var(--ink2);
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    box-shadow: var(--shadow2);
  }
  .dot{
    width:8px; height:8px;
    border-radius:50%;
    background: var(--ok);
    box-shadow: 0 0 0 6px rgba(124,255,167,.12), 0 0 18px rgba(124,255,167,.28);
  }
  .actions{ display:flex; gap:10px; }
  .btn{
    appearance:none;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(255,255,255,.06);
    color:var(--ink);
    padding:8px 12px;
    border-radius:12px;
    font-size:13px;
    cursor:pointer;
    transition: transform .08s ease, background .2s ease, border-color .2s ease;
    box-shadow: var(--shadow2);
  }
  .btn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.20); }
  .btn:active{ transform: translateY(1px) scale(.99); }
  .btn.primary{
    background: linear-gradient(135deg, rgba(181,124,255,.35), rgba(97,208,255,.22));
    border-color: rgba(181,124,255,.35);
  }

  /* ===== feed list ===== */
  .list{ position:relative; padding:10px 10px 12px; }
  .item{
    display:grid;
    grid-template-columns: 42px 1fr auto;
    gap:12px;
    padding:12px 12px;
    border-radius:14px;
    margin:8px 4px;
    background: rgba(0,0,0,.18);
    border:1px solid rgba(255,255,255,.08);
    transition: background .2s ease, border-color .2s ease;
  }
  .item:hover{ background: rgba(0,0,0,.26); border-color: rgba(255,255,255,.16); }
  .ico{
    width:38px; height:38px;
    border-radius:14px;
    display:grid; place-items:center;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    font-size:18px;
    filter: drop-shadow(0 10px 18px rgba(0,0,0,.22));
  }
  .title{
    margin:0;
    font-size:15px;
    line-height:1.35;
    letter-spacing:-.2px;
    color: var(--ink);
    text-shadow: 0 1px 12px rgba(0,0,0,.38);
  }
  .meta{
    margin-top:6px;
    font-size:12px;
    color: var(--muted);
    display:flex;
    gap:10px;
    flex-wrap:wrap;
  }
  .tag{
    padding:4px 8px;
    border-radius:999px;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    color: var(--ink2);
  }
  .time{
    font-size:12px;
    color: rgba(234,240,255,.80);
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(255,255,255,.05);
    height: fit-content;
    align-self:center;
  }
  @media (max-width:560px){
    .item{ grid-template-columns: 42px 1fr; }
    .time{ grid-column: 2 / 3; justify-self:start; margin-top:8px; }
  }

  .hint{
    padding:12px 16px 16px;
    color: rgba(234,240,255,.72);
    font-size:12px;
    border-top:1px solid rgba(255,255,255,.08);
    background: rgba(0,0,0,.10);
  }
  .kbd{
    display:inline-block;
    padding:2px 7px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,.16);
    background: rgba(255,255,255,.08);
    color: var(--ink);
    font-size:11px;
    margin:0 2px;
  }

  /* ===== chat panel ===== */
  .chat{
    display:flex;
    flex-direction:column;
    min-height: 560px;
  }
  @media (max-width: 980px){
    .chat{ min-height: 520px; }
  }

  .chatBody{
    position:relative;
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
    min-height: 0;
    flex:1;
  }

  /* nickname area (top) */
  .nameBox{
    display:flex;
    gap:10px;
    align-items:center;
    padding:10px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
  }
  .nameBox input{
    flex:1;
    padding:12px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.25);
    color:#fff;
    outline:none;
  }
  .nameHint{
    font-size:12px;
    color: rgba(234,240,255,.68);
    white-space:nowrap;
    opacity:.9;
  }

  /* log area (middle) */
  #log{
    flex:1;
    min-height: 0;
    overflow:auto;
    padding:12px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background: rgba(0,0,0,.12);
  }

  .msg{ margin:8px 0; }
  .sys{ opacity:.72; font-size:.92rem; }
  .nick{ color:#a7f3d0; font-weight:700; }

  /* composer (bottom) */
  .composer{
    display:flex;
    gap:10px;
    align-items:center;
    padding:10px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.12);
    background: rgba(0,0,0,.18);
  }
  .composer input{
    flex:1;
    padding:12px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.25);
    color:#fff;
    outline:none;
  }
  .composer button{
    padding:12px 14px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.18);
    background: rgba(255,255,255,.10);
    color:#fff;
    cursor:pointer;
  }
  .composer button:hover{ background: rgba(255,255,255,.14); }

  .tiny{
    font-size:12px;
    color: rgba(234,240,255,.65);
    padding: 0 2px;
    user-select:none;
  }
</style>
</head>

<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>STANCE ‚Äî One-line Feed</h1>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: FEED -->
      <section class="panel" aria-label="One-line feed panel">
        <div class="bar">
          <div class="pill"><span class="dot"></span> LIVE PANEL</div>
          <div class="actions">
            <button class="btn primary" id="btnAdd">+ Add</button>
            <button class="btn" id="btnTop">Top</button>
          </div>
        </div>

        <div class="list" id="feed">
          
          
        </div>

        <div class="hint">
          Îã®Ï∂ïÌÇ§: <span class="kbd">A</span> ÏÉà Ìï≠Î™©(Îß® ÏúÑ), <span class="kbd">T</span> Îß® ÏúÑÎ°ú
        </div>
      </section>

      <aside class="panel chat" aria-label="Flask chat panel">
        <div class="bar">
          <div class="pill"><span class="dot"></span> Flask Ïã§ÏãúÍ∞Ñ Ï±ÑÌåÖ</div>
          <div class="actions">
            <button class="btn" id="btnFocus">Focus</button>
          </div>
        </div>

        <div class="chatBody">
          <div class="nameBox">
            <input id="name" placeholder="ÎãâÎÑ§ÏûÑ" maxlength="30" />
            <button class="btn primary" id="btnSetName">Set</button>
          </div>

          <div id="log"></div>

          <div class="composer">
            <input id="msg" placeholder="Î©îÏãúÏßÄ ÏûÖÎ†•‚Ä¶" maxlength="500" />
            <button id="send">Ï†ÑÏÜ°</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
  /* ===== FEED ===== */
  const feed = document.getElementById("feed");
  const btnAdd = document.getElementById("btnAdd");
  const btnTop = document.getElementById("btnTop");

  function pad(n){ return String(n).padStart(2,"0"); }

  function addItem(){
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = pad(now.getMonth()+1);
    const dd = pad(now.getDate());
    const hh = pad(now.getHours());
    const mi = pad(now.getMinutes());

    const el = document.createElement("article");
    el.className = "item";
    el.innerHTML = `
      <div class="ico">üìù</div>
      <div>
        <p class="title" contenteditable="true" spellcheck="false">Ïó¨Í∏∞Ïóê Ìïú Ï§Ñ ÏûÖÎ†•ÌïòÍ≥† Ï†ÄÏû•Ìï¥Îùº „Öã„Öã</p>
        <div class="meta">
          <span>${yyyy}-${mm}-${dd}</span>
          <span class="tag" contenteditable="true" spellcheck="false">Î©îÎ™®</span>
        </div>
      </div>
      <div class="time">${hh}:${mi}</div>
    `;
    feed.prepend(el);

    const title = el.querySelector(".title");
    title.focus();
    const range = document.createRange();
    range.selectNodeContents(title);
    range.collapse(false);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
  }

  btnAdd.addEventListener("click", addItem);
  btnTop.addEventListener("click", () => window.scrollTo({top:0, behavior:"smooth"}));
  window.addEventListener("keydown", (e) => {
    if(e.target && (e.target.isContentEditable || ["INPUT","TEXTAREA"].includes(e.target.tagName))) return;
    if(e.key.toLowerCase() === "a") addItem();
    if(e.key.toLowerCase() === "t") window.scrollTo({top:0, behavior:"smooth"});
  });

  /* ===== CHAT ===== */
  const log = document.querySelector("#log");
  const nameEl = document.querySelector("#name");
  const msgEl  = document.querySelector("#msg");
  const sendBtn= document.querySelector("#send");
  const btnSetName = document.querySelector("#btnSetName");
  const btnFocus = document.querySelector("#btnFocus");

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }
  function add(html){
    const div = document.createElement("div");
    div.className = "msg";
    div.innerHTML = html;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
  }

  // Ï†ÄÏû•Îêú ÎãâÎÑ§ÏûÑ Î≥µÍµ¨
  const savedName = localStorage.getItem("stance_chat_name");
  if(savedName){
    nameEl.value = savedName;
    nameEl.disabled = true;
    btnSetName.disabled = true;
    btnSetName.textContent = "Set";
  }

  // ‚úÖ ÌïµÏã¨: connect Îïå ÏûêÎèô join ÌïòÏßÄ ÎßêÍ≥†, 'Set'ÏùÑ ÎàåÎ†ÄÏùÑ ÎïåÎßå join 1Ìöå
  let hasJoined = false;

  const sock = io("https://mrdindoin.ddns.net", {
    path: "/jagannath/socket.io",
    transports: ["websocket"],
    withCredentials: true,
    reconnection: true,
    reconnectionAttempts: Infinity,
    reconnectionDelay: 800,
    reconnectionDelayMax: 2500
  });

  sock.on("connect", () => {
    // connect Î°úÍ∑∏Îäî ÎÑàÎ¨¥ Ïä§Ìå∏ ÎÇòÎãà 1Î≤àÎßå ÌëúÏãú
    if(!window.__connectedOnce){
      window.__connectedOnce = true;
      add(`<div class="sys">‚Ä¢ connected</div>`);
    }
    // Ïù¥ÎØ∏ Îãâ Ï†ÄÏû•ÎèºÏûàÍ≥†, join ÏïàÌñàÏúºÎ©¥ 1Ìöå join
    if(!hasJoined && localStorage.getItem("stance_chat_name")){
      doJoin(true); // silent join
    }
  });

  sock.on("disconnect", () => {
    // disconnectÎèÑ Ïä§Ìå∏Ïù¥Î©¥ ÎπºÍ≥† Ïã∂ÏúºÎ©¥ Ï£ºÏÑù Ï≤òÎ¶¨
    add(`<div class="sys">‚Ä¢ disconnected</div>`);
  });

  sock.on("system", (d) => add(`<div class="sys">‚Ä¢ ${escapeHtml(d.msg||"")}</div>`));
  sock.on("chat", (d) => add(`<span class="nick">${escapeHtml(d.name||"anon")}</span> : ${escapeHtml(d.msg||"")}`));

  function doJoin(silent=false){
    if(hasJoined) return;
    const name = (nameEl.value || "anon").trim().slice(0,30);
    if(!name){
      if(!silent) add(`<div class="sys">‚Ä¢ ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•Ìï¥Ï§ò</div>`);
      return;
    }
    hasJoined = true;
    sock.emit("join", {name});
    if(!silent) add(`<div class="sys">‚Ä¢ ÎãâÎÑ§ÏûÑ ÏÑ§Ï†ï: ${escapeHtml(name)}</div>`);
  }

  btnSetName.addEventListener("click", () => {
    const name = (nameEl.value || "").trim().slice(0,30);
    if(!name){
      add(`<div class="sys">‚Ä¢ ÎãâÎÑ§ÏûÑÏùÑ Î®ºÏ†Ä ÏûÖÎ†•Ìï¥Ï§ò</div>`);
      nameEl.focus();
      return;
    }
    localStorage.setItem("stance_chat_name", name);
    nameEl.disabled = true;
    btnSetName.disabled = true;
    doJoin(false);
    msgEl.focus();
  });

  nameEl.addEventListener("keydown", (e)=>{
    if(e.key === "Enter") btnSetName.click();
  });

  function send(){
    const name = (localStorage.getItem("stance_chat_name") || nameEl.value || "anon").trim().slice(0,30);
    const msg  = (msgEl.value || "").trim().slice(0,500);
    if(!msg) return;

    // ÎãâÎÑ§ÏûÑ ÌôïÏ†ï ÏïàÌñàÎäîÎç∞ Î≥¥ÎÇ¥Î†§ÌïòÎ©¥ ÏïàÎÇ¥
    if(!localStorage.getItem("stance_chat_name")){
      add(`<div class="sys">‚Ä¢ ÎãâÎÑ§ÏûÑÎ∂ÄÌÑ∞ Set ÎàåÎü¨Îùº „Öã„Öã</div>`);
      nameEl.focus();
      return;
    }

    // ÌòπÏãú join ÏïÑÏßÅÏù¥Î©¥(ÏÉàÎ°úÍ≥†Ïπ® ÏßÅÌõÑ) join ÌïúÎ≤à ÌïòÍ≥† Ï†ÑÏÜ°
    if(!hasJoined) doJoin(true);

    sock.emit("chat", {name, msg});
    msgEl.value = "";
    msgEl.focus();
  }

  sendBtn.addEventListener("click", send);
  msgEl.addEventListener("keydown", (e)=>{ if(e.key==="Enter") send(); });

  btnFocus.addEventListener("click", () => {
    if(localStorage.getItem("stance_chat_name")) msgEl.focus();
    else nameEl.focus();
  });
</script>
</body>
</html>
