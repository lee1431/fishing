<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>eBay ì¶”ì²œ ë¸”ë¡ 4ê°œ ì´ë¯¸ì§€ ì½”ë“œ ìƒì„±ê¸°</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:#f5f5f5;
      margin:0;
    }
    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 40px;
    }
    h1 {
      font-size: 1.7rem;
      margin-bottom: 6px;
    }
    .muted {
      color:#666;
      font-size:0.9rem;
      margin-bottom:18px;
    }
    label {
      display:block;
      font-weight:600;
      margin:10px 0 4px;
      font-size:0.9rem;
    }
    input[type="text"] {
      width:100%;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:0.9rem;
      font-family:inherit;
    }
    .btn {
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:8px 16px;
      border-radius:999px;
      border:1px solid #111;
      background:#111;
      color:#fff;
      font-size:0.9rem;
      margin-top:12px;
      cursor:pointer;
      text-decoration:none;
      gap:6px;
    }
    .btn.sub {
      background:#fff;
      color:#111;
      border-color:#ccc;
      margin-left:8px;
    }
    .btn:disabled {
      opacity:0.5;
      cursor:default;
    }

    .url-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(220px,1fr));
      gap:12px 18px;
      margin-top:10px;
    }
    .url-card {
      background:#fff;
      border-radius:12px;
      padding:10px 12px 12px;
      box-shadow:0 2px 5px rgba(0,0,0,0.04);
      border:1px solid #e4e4e4;
    }
    .url-title {
      font-size:0.9rem;
      font-weight:600;
      margin-bottom:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .url-tag {
      font-size:0.75rem;
      padding:2px 8px;
      border-radius:999px;
      background:#111;
      color:#fff;
    }

    .section-title {
      margin-top:24px;
      font-size:1rem;
      font-weight:600;
    }
    .slot-grid {
      margin-top:14px;
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(220px,1fr));
      gap:16px;
    }

    .slot {
      background:#fff;
      border-radius:14px;
      padding:10px 10px 14px;
      border:1px solid #e4e4e4;
      box-shadow:0 2px 5px rgba(0,0,0,0.04);
      min-height:210px;
      display:flex;
      flex-direction:column;
    }
    .slot-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-size:0.9rem;
      margin-bottom:8px;
    }
    .slot-name {
      font-weight:600;
    }
    .slot-status {
      font-size:0.75rem;
      padding:2px 8px;
      border-radius:999px;
      background:#f2f2f2;
      color:#555;
    }

    .thumb-grid {
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:8px;
      flex:1;
    }
    .thumb {
      position:relative;
      border-radius:10px;
      overflow:hidden;
      border:2px solid transparent;
      background:#eee;
      cursor:pointer;
      aspect-ratio:4/3;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:0.8rem;
      color:#999;
    }
    .thumb img {
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .thumb.selected {
      border-color:#111;
      box-shadow:0 0 0 2px #111;
    }
    .thumb-tag {
      position:absolute;
      bottom:6px;
      left:6px;
      padding:2px 8px;
      border-radius:999px;
      background:rgba(0,0,0,0.7);
      color:#fff;
      font-size:0.7rem;
    }

    .code-box {
      margin-top:10px;
    }
    .code-area {
      width:100%;
      min-height:140px;
      font-family:Menlo,Consolas,monospace;
      font-size:0.85rem;
      border-radius:10px;
      border:1px solid #ccc;
      padding:10px;
      box-sizing:border-box;
      background:#111;
      color:#f5f5f5;
      resize:vertical;
    }
    .code-footer {
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:0.8rem;
      gap:8px;
      flex-wrap:wrap;
    }
    .pill {
      padding:2px 8px;
      border-radius:999px;
      background:#e9e9e9;
      color:#555;
    }
    @media (max-width:600px) {
      h1 { font-size:1.4rem; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>eBay ì¶”ì²œ ë¸”ë¡ (4ê°œ) ì´ë¯¸ì§€ ì½”ë“œ ìƒì„±ê¸°</h1>
    <div class="muted">
      eBay ìƒí’ˆ URL 4ê°œë¥¼ ì…ë ¥í•˜ë©´, ê° ìƒí’ˆì˜ ìƒì„¸í˜ì´ì§€ì—ì„œ ì´ë¯¸ì§€ë¥¼ ëª¨ì•„ ë³´ì—¬ì£¼ê³ <br>
      ì„ íƒëœ 4ê°œ ì´ë¯¸ì§€ë¡œ <code>.product-recommendation</code> ë¸”ë¡ HTMLì„ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.
    </div>

    <!-- URL ì…ë ¥ 4ê°œ -->
    <div class="url-grid">
      <div class="url-card">
        <div class="url-title">
          <span>ì¶”ì²œ 1ë²ˆ ìƒí’ˆ URL</span>
          <span class="url-tag">slot 1</span>
        </div>
        <input type="text" id="url1" placeholder="https://www.ebay.com/itm/..." />
      </div>
      <div class="url-card">
        <div class="url-title">
          <span>ì¶”ì²œ 2ë²ˆ ìƒí’ˆ URL</span>
          <span class="url-tag">slot 2</span>
        </div>
        <input type="text" id="url2" placeholder="https://www.ebay.com/itm/..." />
      </div>
      <div class="url-card">
        <div class="url-title">
          <span>ì¶”ì²œ 3ë²ˆ ìƒí’ˆ URL</span>
          <span class="url-tag">slot 3</span>
        </div>
        <input type="text" id="url3" placeholder="https://www.ebay.com/itm/..." />
      </div>
      <div class="url-card">
        <div class="url-title">
          <span>ì¶”ì²œ 4ë²ˆ ìƒí’ˆ URL</span>
          <span class="url-tag">slot 4</span>
        </div>
        <input type="text" id="url4" placeholder="https://www.ebay.com/itm/..." />
      </div>
    </div>

    <button class="btn" id="btn-fetch">4ê°œ ìƒí’ˆ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°</button>

    <!-- ìŠ¬ë¡¯ë³„ ì´ë¯¸ì§€ ì„ íƒ -->
    <div class="section-title">1. ê° ì¶”ì²œ ìŠ¬ë¡¯ì˜ ëŒ€í‘œ ì´ë¯¸ì§€ ì„ íƒ</div>
    <div class="slot-grid">
      <div class="slot" data-slot="slot1">
        <div class="slot-header">
          <span class="slot-name">ì¶”ì²œ 1ë²ˆ</span>
          <span class="slot-status" id="status-slot1">URL ì…ë ¥ í›„ "ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°"</span>
        </div>
        <div class="thumb-grid" id="grid-slot1">
          <!-- ì´ë¯¸ì§€ ì¸ë„¤ì¼ë“¤ -->
        </div>
      </div>
      <div class="slot" data-slot="slot2">
        <div class="slot-header">
          <span class="slot-name">ì¶”ì²œ 2ë²ˆ</span>
          <span class="slot-status" id="status-slot2">URL ì…ë ¥ í›„ "ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°"</span>
        </div>
        <div class="thumb-grid" id="grid-slot2"></div>
      </div>
      <div class="slot" data-slot="slot3">
        <div class="slot-header">
          <span class="slot-name">ì¶”ì²œ 3ë²ˆ</span>
          <span class="slot-status" id="status-slot3">URL ì…ë ¥ í›„ "ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°"</span>
        </div>
        <div class="thumb-grid" id="grid-slot3"></div>
      </div>
      <div class="slot" data-slot="slot4">
        <div class="slot-header">
          <span class="slot-name">ì¶”ì²œ 4ë²ˆ</span>
          <span class="slot-status" id="status-slot4">URL ì…ë ¥ í›„ "ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸°"</span>
        </div>
        <div class="thumb-grid" id="grid-slot4"></div>
      </div>
    </div>

    <!-- ìµœì¢… ì½”ë“œ -->
    <div class="section-title">2. ìƒì„±ëœ ìµœì¢… ì½”ë“œ</div>
    <div class="code-box">
      <textarea id="final-code" class="code-area" readonly></textarea>
      <div class="code-footer">
        <span id="final-status" class="pill">4ê°œì˜ ëŒ€í‘œ ì´ë¯¸ì§€ë¥¼ ëª¨ë‘ ì„ íƒí•˜ë©´ ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.</span>
        <button class="btn sub" id="btn-copy" disabled>ì½”ë“œ ë³µì‚¬</button>
      </div>
    </div>
  </div>

  <script>
    // â˜… ì—¬ê¸° URLì„ ë„¤ ì„œë²„ ì£¼ì†Œì— ë§ê²Œ ì¡°ì •í•´ë„ ë¨
    const API_URL = "https://localflow.ddns.net/ebayimages/api/ebay-desc-images";

    const urlInputs = {
      slot1: document.getElementById("url1"),
      slot2: document.getElementById("url2"),
      slot3: document.getElementById("url3"),
      slot4: document.getElementById("url4"),
    };

    const grids = {
      slot1: document.getElementById("grid-slot1"),
      slot2: document.getElementById("grid-slot2"),
      slot3: document.getElementById("grid-slot3"),
      slot4: document.getElementById("grid-slot4"),
    };

    const statusEls = {
      slot1: document.getElementById("status-slot1"),
      slot2: document.getElementById("status-slot2"),
      slot3: document.getElementById("status-slot3"),
      slot4: document.getElementById("status-slot4"),
    };

    const btnFetch   = document.getElementById("btn-fetch");
    const finalCode  = document.getElementById("final-code");
    const finalStatus= document.getElementById("final-status");
    const btnCopy    = document.getElementById("btn-copy");

    const selectedImages = {
      slot1: null,
      slot2: null,
      slot3: null,
      slot4: null,
    };

    async function fetchImagesForSlot(slotKey) {
      const url = (urlInputs[slotKey].value || "").trim();
      const grid = grids[slotKey];
      const st   = statusEls[slotKey];

      grid.innerHTML = "";
      selectedImages[slotKey] = null;

      if (!url) {
        st.textContent = "URLì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.";
        return;
      }

      st.textContent = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url })
        });

        const j = await res.json();
        if (!res.ok) {
          st.textContent = "ì—ëŸ¬: " + (j.message || j.error || res.status);
          return;
        }

        const imgs = j.images || j; // (ì„œë²„ êµ¬í˜„ì— ë”°ë¼ j.images ë˜ëŠ” j)
        if (!imgs || !imgs.length) {
          st.textContent = "ì´ë¯¸ì§€ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
          return;
        }

        imgs.forEach((img, idx) => {
          const src = img.src || img; // í˜•íƒœì— ë”°ë¼ ì²˜ë¦¬
          const div = document.createElement("div");
          div.className = "thumb";

          const tag = document.createElement("div");
          tag.className = "thumb-tag";
          tag.textContent = "ì´ë¯¸ì§€ " + (idx + 1);

          const el = document.createElement("img");
          el.src = src;

          div.appendChild(el);
          div.appendChild(tag);

          div.addEventListener("click", () => {
            // ê°™ì€ ìŠ¬ë¡¯ ë‚´ì˜ ì„ íƒ í‘œì‹œ ë¦¬ì…‹
            grid.querySelectorAll(".thumb").forEach(t => t.classList.remove("selected"));
            div.classList.add("selected");
            selectedImages[slotKey] = src;
            st.textContent = "ì„ íƒë¨: ì´ë¯¸ì§€ " + (idx + 1);
            updateFinalCode();
          });

          grid.appendChild(div);
        });

        st.textContent = "ëŒ€í‘œ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”.";
      } catch (e) {
        console.error(e);
        st.textContent = "ìš”ì²­ ì‹¤íŒ¨. ì„œë²„ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.";
      }
    }

    btnFetch.addEventListener("click", async () => {
      finalStatus.textContent = "ì´ë¯¸ì§€ ë¡œë”© ì¤‘...";
      btnFetch.disabled = true;
      btnCopy.disabled = true;
      finalCode.value = "";

      // 4ê°œ ìŠ¬ë¡¯ ëª¨ë‘ ë³‘ë ¬ ìš”ì²­
      await Promise.all([
        fetchImagesForSlot("slot1"),
        fetchImagesForSlot("slot2"),
        fetchImagesForSlot("slot3"),
        fetchImagesForSlot("slot4"),
      ]);

      finalStatus.textContent = "ê° ìŠ¬ë¡¯ì—ì„œ ëŒ€í‘œ ì´ë¯¸ì§€ë¥¼ í•˜ë‚˜ì”© ì„ íƒí•´ ì£¼ì„¸ìš”.";
      btnFetch.disabled = false;
    });

    function updateFinalCode() {
      const slots = [
        selectedImages.slot1,
        selectedImages.slot2,
        selectedImages.slot3,
        selectedImages.slot4,
      ];

      // ê° ìŠ¬ë¡¯ ìƒí’ˆ URL
      const hrefs = [
        (urlInputs.slot1.value || "").trim(),
        (urlInputs.slot2.value || "").trim(),
        (urlInputs.slot3.value || "").trim(),
        (urlInputs.slot4.value || "").trim(),
      ];
    
      // ì´ë¯¸ì§€ 4ê°œ / URL 4ê°œ ë‹¤ ì±„ì›Œì ¸ì•¼ ìƒì„±
      if (slots.some(v => !v) || hrefs.some(v => !v)) {
        finalCode.value = "4ê°œì˜ ëŒ€í‘œ ì´ë¯¸ì§€ì™€ 4ê°œì˜ ìƒí’ˆ URLì´ ëª¨ë‘ ìˆì–´ì•¼ ì½”ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.";
        btnCopy.disabled = true;
        finalStatus.textContent = "ì•„ì§ ë¹„ì–´ ìˆëŠ” ìŠ¬ë¡¯ ë˜ëŠ” URLì´ ìˆìŠµë‹ˆë‹¤.";
        return;
      }

      const html =
`<div class="product-recommendation">
  <h3>
   ğŸŠ You might also like
  </h3>
  <div class="recommendation-list">
   <div class="recommendation-item">
    <a href="${hrefs[0]}">
     <img alt="" src="${slots[0]}">
     </img>
    </a>
   </div>
   <div class="recommendation-item">
    <a href="${hrefs[1]}">
     <img alt="" src="${slots[1]}">
     </img>
    </a>
   </div>
   <div class="recommendation-item">
    <a href="${hrefs[2]}">
     <img alt="" src="${slots[2]}">
     </img>
    </a>
   </div>
   <div class="recommendation-item">
    <a href="${hrefs[3]}">
     <img alt="" src="${slots[3]}">
     </img>
    </a>
   </div>
  </div>
 </div>`;

      finalCode.value = html;
      btnCopy.disabled = false;
      finalStatus.textContent = "ì½”ë“œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. 'ì½”ë“œ ë³µì‚¬' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ë² ì´ì— ë¶™ì—¬ ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.";
    }

    btnCopy.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(finalCode.value);
        finalStatus.textContent = "ë³µì‚¬ ì™„ë£Œ!";
      } catch {
        finalStatus.textContent = "ë³µì‚¬ ì‹¤íŒ¨. ì§ì ‘ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.";
      }
    });
  </script>
</body>
</html>
