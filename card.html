<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>카드 슬라이더</title>
<style>
  :root{
    --bg:#0b0f17; --fg:#e8eefc; --muted:#9fb0c8; --accent:#7aa2ff; --card:#121826;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--fg);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Apple SD Gothic Neo,Noto Sans KR,Arial;
    background: radial-gradient(1200px 800px at 20% -10%, #152037, transparent 60%),
                radial-gradient(900px 600px at 100% 0%, #0f1627, transparent 60%), var(--bg);
  }
  .wrap{max-width:1100px;margin:40px auto;padding:0 16px}
  h1{font-size:clamp(24px,3.2vw,36px);margin:0 0 14px}
  .sub{color:var(--muted);margin:0 0 22px}

  .searchbar{position:relative;max-width:680px}
  #q{
    width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);
    background:#0f1627;color:#e8eefc;outline:none;
  }
  #suggest{
    position:absolute;left:0;right:0;top:48px;background:#0f1627;border:1px solid rgba(255,255,255,.15);
    border-radius:12px;max-height:260px;overflow:auto;display:none;z-index:10;box-shadow:0 12px 24px rgba(0,0,0,.35);
  }
  #suggest button{display:block;width:100%;text-align:left;padding:10px 12px;background:transparent;border:0;color:#e8eefc;cursor:pointer}

  .slider{position:relative;user-select:none;-webkit-user-select:none}
  .track{
    display:grid;grid-auto-flow:column;grid-auto-columns:85%;
    gap:16px;overflow-x:auto;padding:12px 8px 24px;scroll-snap-type:x mandatory;scroll-padding:8px;
    -webkit-overflow-scrolling:touch; scrollbar-width:none;
  }
  .track::-webkit-scrollbar{display:none}
  @media (min-width:640px){ .track{ grid-auto-columns:calc(50% - 12px);} }
  @media (min-width:1024px){ .track{ grid-auto-columns:calc(33.333% - 11px);} }

  .card{
    scroll-snap-align:start;background:linear-gradient(180deg,rgba(255,255,255,.03),transparent 30%),var(--card);
    border:1px solid rgba(255,255,255,.05);border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,.35);
    overflow:hidden;min-height:300px;display:flex;flex-direction:column;
  }
  .media{aspect-ratio:16/10;background:#0c1323;display:flex;align-items:center;justify-content:center}
  .media .sym{font-size:28px;font-weight:800;letter-spacing:.5px;opacity:.95}
  .content{padding:16px;display:grid;gap:6px}
  .title{font-weight:700}
  .desc{color:var(--muted);font-size:14px;line-height:1.45}
  .tags{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .tag{font-size:12px;color:var(--accent);background:rgba(122,162,255,.1);border:1px solid rgba(122,162,255,.25);padding:4px 8px;border-radius:999px}

  .navBtn{
    position:absolute;inset-block:0;margin:auto 0;height:44px;width:44px;border-radius:999px;border:1px solid rgba(255,255,255,.15);
    background:rgba(16,22,35,.6);backdrop-filter:blur(6px);display:grid;place-items:center;cursor:pointer;z-index:5;
    transition:transform .12s ease, background .2s ease, border-color .2s ease;
  }
  .navBtn:hover{background:rgba(18,28,48,.8);border-color:rgba(255,255,255,.25)}
  .navBtn:active{transform:scale(.96)}
  .prev{left:-6px} .next{right:-6px}
  .navBtn[disabled]{opacity:.35;pointer-events:none}

  .dragging{cursor:grabbing}
</style>
</head>
<body>
  <div class="wrap">
    <h1>카드 슬라이더</h1>
    <p class="sub">도트 없는 버전. 드래그·휠·버튼·키보드·검색 필터 지원.</p>

    <div class="searchbar">
      <input id="q" type="text" placeholder="심볼 검색 (예: BTCUSDT, ETHUSDT)" aria-label="심볼 검색">
      <div id="suggest" role="listbox" aria-label="자동완성"></div>
    </div>

    <section class="slider" role="region" aria-label="카드 슬라이더">
      <button class="navBtn prev" aria-label="이전">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <button class="navBtn next" aria-label="다음">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <div class="track" id="track" tabindex="0" role="group" aria-roledescription="수평 캐러셀"></div>
    </section>
  </div>

<script>
(async function(){
  const track   = document.getElementById('track');
  const prevBtn = document.querySelector('.prev');
  const nextBtn = document.querySelector('.next');
  const qInput  = document.getElementById('q');
  const suggest = document.getElementById('suggest');

  // -------- 데이터 로드 --------
  async function loadSymbols(){
    try{
      const res = await fetch('./tt.json', {cache:'no-store'});
      const data = await res.json();
      const arr = Array.isArray(data) ? data : (Array.isArray(data.items)? data.items:[]);
      return arr.map(x => typeof x==='string' ? x : (x.symbol||'')).filter(Boolean);
    }catch(e){ console.error('tt.json 로드 실패', e); return []; }
  }
  let ALL = (await loadSymbols()).map(s=>String(s).toUpperCase().trim()).filter(Boolean);
  ALL = [...new Set(ALL)];
  let CURRENT = [...ALL];

  // -------- UI 빌드 --------
  function buildCards(list){
    track.innerHTML = list.map(sym => `
      <article class="card">
        <div class="media"><div class="sym">${sym}</div></div>
        <div class="content">
          <div class="title">${sym} <small style="color:#9fb0c8;">(로고는 추후 캐시)</small></div>
          <div class="desc">JSON(tt.json)에서 읽은 심볼 카드. 검색으로 필터링 가능.</div>
          <div class="tags"><span class="tag">local</span><span class="tag">json</span></div>
        </div>
      </article>
    `).join('');
  }

  // -------- 페이지 계산(정확 좌표 방식) --------
  function cardWidth(){
    const first = track.children[0];
    if(!first) return 1;
    const styles = getComputedStyle(track);
    const gap = parseFloat(styles.columnGap || styles.gap || 0);
    return first.getBoundingClientRect().width + gap;
  }
  function visibleCount(){
    const first = track.children[0];
    if(!first) return 1;
    const cw = first.getBoundingClientRect().width || 1;
    const tw = track.getBoundingClientRect().width || cw;
    return Math.max(1, Math.round(tw / cw));
  }
  function _metrics(){
    const v = visibleCount();
    const total = track.children.length;
    const pages = Math.max(1, Math.ceil(total / v));
    const w = cardWidth();
    const lastStart = Math.max(0, total - v);
    return {v,total,pages,w,lastStart};
  }
  function _pageLefts(){
    const {v,pages,w,lastStart} = _metrics();
    const lefts=[];
    for(let p=0;p<pages;p++){
      const startIdx = Math.min(lastStart, Math.max(0, p*v));
      lefts.push(startIdx * w);
    }
    return lefts;
  }
  function currentPage(){
    const left = track.scrollLeft;
    const arr = _pageLefts();
    let best=0, dmin=Infinity;
    for(let i=0;i<arr.length;i++){
      const d = Math.abs(left - arr[i]);
      if(d < dmin){ dmin=d; best=i; }
    }
    return best;
  }
  function goToPage(p, smooth=true){
    const arr = _pageLefts();
    const idx = Math.max(0, Math.min(arr.length-1, p|0));
    const target = arr[idx] || 0;
    track.scrollTo({left: target, behavior: smooth?'smooth':'auto'});
  }
  function updateUI(){
    const {pages,total} = _metrics();
    const page = currentPage();
    const one = (pages<=1 || total===0);
    prevBtn.disabled = one || page<=0;
    nextBtn.disabled = one || page>=pages-1;
  }

  // -------- 초기 렌더 --------
  buildCards(CURRENT);
  track.scrollLeft = 0;
  goToPage(0,false);
  updateUI();

  // -------- 네비 버튼 --------
  prevBtn.addEventListener('click', ()=>{ goToPage(currentPage()-1); setTimeout(updateUI,0); });
  nextBtn.addEventListener('click', ()=>{ goToPage(currentPage()+1); setTimeout(updateUI,0); });

  // -------- 키보드 --------
  track.addEventListener('keydown', (e)=>{
    if(e.key==='ArrowRight'){ e.preventDefault(); nextBtn.click(); }
    if(e.key==='ArrowLeft'){  e.preventDefault(); prevBtn.click(); }
  });

  // -------- 스크롤/휠/드래그 --------
  let t; track.addEventListener('scroll', ()=>{ clearTimeout(t); t=setTimeout(updateUI,80); }, {passive:true});
  track.addEventListener('wheel', (e)=>{
    if(Math.abs(e.deltaY) > Math.abs(e.deltaX)){ track.scrollLeft += e.deltaY; e.preventDefault(); }
  }, {passive:false});

  let isDown=false,startX=0,startLeft=0;
  const onDown = (e)=>{ isDown=true; startX=(e.touches?e.touches[0].clientX:e.clientX); startLeft=track.scrollLeft; track.classList.add('dragging'); };
  const onMove = (e)=>{ if(!isDown) return; const x=(e.touches?e.touches[0].clientX:e.clientX); track.scrollLeft=startLeft-(x-startX); };
  const onUp   = ()=>{ if(!isDown) return; isDown=false; track.classList.remove('dragging'); goToPage(currentPage()); };
  track.addEventListener('pointerdown',(e)=>{ onDown(e); track.setPointerCapture(e.pointerId); });
  track.addEventListener('pointermove',onMove);
  track.addEventListener('pointerup',onUp);
  track.addEventListener('pointerleave',onUp);
  track.addEventListener('touchstart',onDown,{passive:true});
  track.addEventListener('touchmove',onMove,{passive:true});
  track.addEventListener('touchend',onUp);

  // -------- 검색/자동완성 --------
  function renderSuggest(list){
    if(!list.length){ suggest.style.display='none'; suggest.innerHTML=''; return; }
    suggest.innerHTML = list.slice(0,8).map(s=>`<button role="option" data-v="${s}">${s}</button>`).join('');
    suggest.style.display='block';
    suggest.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click',()=>{ qInput.value=btn.dataset.v; applyFilter(); suggest.style.display='none'; });
    });
  }
  function applyFilter(){
    const q = qInput.value.trim().toUpperCase();
    CURRENT = q ? ALL.filter(s=>s.includes(q)) : ALL;
    buildCards(CURRENT);
    track.scrollLeft = 0;
    goToPage(0,false);
    updateUI();
    renderSuggest([]);
  }
  qInput.addEventListener('input', ()=>{
    const q=qInput.value.trim().toUpperCase();
    if(!q){ renderSuggest([]); applyFilter(); return; }
    renderSuggest(ALL.filter(s=>s.includes(q)));
  });
  qInput.addEventListener('keydown',(e)=>{
    if(e.key==='Enter'){ e.preventDefault(); applyFilter(); }
    if(e.key==='Escape'){ suggest.style.display='none'; }
  });
  document.addEventListener('click',(e)=>{
    if(!suggest.contains(e.target) && e.target!==qInput){ suggest.style.display='none'; }
  });

  // -------- 리사이즈 --------
  let rt; window.addEventListener('resize', ()=>{
    clearTimeout(rt); rt=setTimeout(()=>{ goToPage(currentPage(),false); updateUI(); },120);
  });
})();
</script>
</body>
</html>
