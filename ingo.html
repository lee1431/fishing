<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¸í„°ë„· ê³ ë¬¼ìƒ â€” ì¡ë™ì‚¬ë‹ˆ ìœ í‹¸ ë³´ê´€ì†Œ</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=VT323&family=Special+Elite&display=swap');
    :root{
      --bg:#0c0b0a; --panel:#15120f; --muted:#c4bdb3; --text:#f7f2e8; --brand:#ffcf6e;
      --card:#1a1713; --accent:#a9e86e; --warn:#ffd36e; --ink:#2b2620;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text)}
    body{font-family: 'Special Elite', 'Apple SD Gothic Neo', 'Noto Sans KR', system-ui, sans-serif;}
    .wrap{max-width:1120px;margin:0 auto;padding:16px}
    a{color:var(--brand);text-decoration:none}

    nav{display:flex;gap:16px;justify-content:center;margin:12px 0 20px}
    nav a{font-family:"VT323", monospace;padding:8px 14px;border:2px solid #3a3127;border-radius:8px;background:#1a1612;color:var(--brand);font-size:16px;transition:background .2s}
    nav a:hover{background:#2a241e}

    body::before{content:"";position:fixed;inset:0;pointer-events:none;background:
      repeating-linear-gradient(0deg,rgba(255,255,255,.03) 0 1px, transparent 1px 3px);
      opacity:.12;mix-blend-mode:soft-light}
    body::after{content:"";position:fixed;inset:0;pointer-events:none;opacity:.08;mix-blend-mode:overlay;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/></filter><rect width="160" height="160" filter="url(%23n)" opacity=".35"/></svg>') repeat;}

    header{position:relative;display:flex;gap:16px;align-items:center;justify-content:space-between;padding:18px;border-radius:18px;background:
      linear-gradient(180deg, rgba(255,232,186,.06), rgba(255,232,186,.02));
      border:2px solid #2f281f; box-shadow:0 3px 0 #0a0908, inset 0 0 60px rgba(255,214,153,.05)}
    header h1{margin:0;font-size: clamp(22px,3.5vw,36px);letter-spacing:.5px;text-shadow:0 1px 0 #000}
    header .hero{align-items:center}
    header .badge{font-family:"VT323", monospace; font-size:14px; letter-spacing:1px;color:#2a1f12;background:var(--warn);padding:6px 10px;border-radius:6px;border:2px solid #3a2f22;box-shadow:0 2px 0 #2a1f12}

    .controls{display:flex;gap:8px;flex-wrap:wrap;width:100%}
    .controls input,.controls select{flex:1;background:#0e0d0b;color:var(--text);border:2px solid #3a3127;border-radius:8px;padding:10px 12px;box-shadow:inset 0 1px 0 #000}
    .controls .btn{border:2px solid #3a3127}

    .section{margin:26px 0}
    .section h2{font-family:"VT323", monospace;margin:0 0 12px;font-size:22px;color:var(--brand)}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px}

    .card{position:relative;border:2px solid #3a3127;border-radius:14px;background:
      linear-gradient(180deg,#201b16,#15110e);
      overflow:hidden; box-shadow:0 4px 0 #0a0908}

    .thumb{aspect-ratio:16/9;background:#12100d}

    .body{padding:14px}
    .title{font-weight:800;margin:0 0 6px; font-family:"VT323", monospace; font-size:22px; letter-spacing:.5px; text-shadow:0 2px 0 #000}
    .meta{font-size:12px;color:var(--muted);display:flex;gap:8px;flex-wrap:wrap}
    .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .tag{font-size:11px;color:var(--brand);background:#54463444;border:1px solid #6a5a474d;padding:4px 8px;border-radius:999px}

    .actions{display:flex;gap:8px;margin-top:12px}
    .btn{flex:1;display:inline-flex;align-items:center;justify-content:center;gap:8px;border-radius:10px;padding:10px 12px;border:2px solid #3a3127;background:#15110e;color:var(--text);cursor:pointer;box-shadow:0 3px 0 #0a0908;transition:transform .05s ease}
    .btn:active{transform:translateY(2px);box-shadow:0 1px 0 #0a0908}
    .btn.primary{background:linear-gradient(180deg,#2a231c,#1a1511)}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .ad{margin:16px 0;padding:12px;border:2px dashed #3a3127;border-radius:12px;color:var(--muted);text-align:center;background:#0f0d0b}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#2b231b;color:#f1e6d3;border:1px solid #3a3127;font-size:12px}

    .footer{margin:32px 0;color:var(--muted);font-size:13px;text-align:center}
    .layout{display:grid;grid-template-columns:1fr;gap:24px}
    @media(min-width:1024px){.layout{grid-template-columns:1fr 300px}}

    /* ëª¨ë°”ì¼: íƒ€ì´í‹€/ë±ƒì§€ ìˆ¨ê¸°ê³  ê²€ìƒ‰ë§Œ ë‚¨ê¸°ê¸° */
    @media(max-width:640px){
      header .hero{display:none}
      header{justify-content:center}
      .controls{justify-content:center}
      .controls select, .controls .btn{display:none}
      nav{flex-wrap:wrap}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="controls">
        <input id="q" placeholder="ê²€ìƒ‰: í‚¤ì›Œë“œ / íƒœê·¸" />
        <select id="sort">
          <option value="new">ìµœì‹ ìˆœ</option>
          <option value="dl">ë‹¤ìš´ë¡œë“œìˆœ</option>
          <option value="hot">ì¸ê¸°</option>
        </select>
        <button class="btn" id="randomBtn">ì˜¤ëŠ˜ì˜ ê³ ë¬¼ ğŸ²</button>
      </div>
    </header>

    <nav>
      <a href="#models">3Dëª¨ë¸</a>
      <a href="#utils">ìœ í‹¸ë¦¬í‹°</a>
      <a href="#music">ìŒì›</a>
      <a href="#art">ê·¸ë¦¼</a>
    </nav>

    <main>
      <section id="models" class="section">
        <h2>ğŸ§± 3Dëª¨ë¸</h2>
        <div class="grid" data-cat="models"></div>
      </section>
      <section id="utils" class="section">
        <h2>ğŸ› ï¸ ìœ í‹¸ë¦¬í‹°</h2>
        <div class="grid" data-cat="utils"></div>
      </section>
      <section id="music" class="section">
        <h2>ğŸµ ìŒì›</h2>
        <div class="grid" data-cat="music"></div>
      </section>
      <section id="art" class="section">
        <h2>ğŸ–¼ï¸ ê·¸ë¦¼</h2>
        <div class="grid" data-cat="art"></div>
      </section>
    </main>

    <footer class="footer">Â© <span id="year"></span> ì¸í„°ë„· ê³ ë¬¼ìƒ</footer>
  </div>

  <script src="./ingoconfig.js"></script>
  <script>
  // ===== ìŠ¤í‚¤ë§ˆ ì°¸ê³  =====
  // item: {
  //   id, title, desc, tags:[], category: 'models'|'utils'|'music'|'art',
  //   createdAt, downloads, score, url, live, cover, changelog:[]
  // }

  const $ = (s, el=document) => el.querySelector(s);
  const $$ = (s, el=document) => [...el.querySelectorAll(s)];
  const fmt = n => (n??0).toLocaleString('ko-KR');

  const state = { items: [] };
  const ITEMS_API = window.INGO_API || "https://mrdindoin.ddns.net/ingo/items";

  async function loadItems(){
    try{
      const r = await fetch(ITEMS_API, { cache: 'no-store' });
      if(!r.ok) throw new Error(r.status);
      state.items = await r.json();
    }catch(e){
      console.error(e);
      state.items = [];
    }
  }

  function render(){
    const key = ($('#q')?.value||'').trim().toLowerCase();
    const by = $('#sort')?.value || 'new';
    let list = state.items.filter(i=>{
      const inKey = !key || [i.title,i.desc,...(i.tags||[])].join(' ').toLowerCase().includes(key);
      return inKey;
    });
    if(by==='new') list.sort((a,b)=> (b.createdAt||'').localeCompare(a.createdAt||''));
    if(by==='dl') list.sort((a,b)=> (b.downloads||0) - (a.downloads||0));
    if(by==='hot') list.sort((a,b)=> (b.score||0) - (a.score||0));

    const boxes = { models: $('[data-cat="models"]'), utils: $('[data-cat="utils"]'), music: $('[data-cat="music"]'), art: $('[data-cat="art"]') };
    Object.values(boxes).forEach(b=> b.innerHTML='');

    for(const i of list){
      const el = card(i);
      const box = boxes[i.category] || boxes.utils;
      box.appendChild(el);
    }
  }

  const API_BASE = (() => {
    try {
    const u = new URL(ITEMS_API);
    return u.origin + (u.pathname.startsWith('/ingo') ? '/ingo' : '');
    } catch { return ''; }
  })();

  document.addEventListener('click', (e) => {
  const a = e.target.closest('a.btn.primary[data-id]');
  if (!a) return;

  e.preventDefault();
  const id = a.dataset.id;

  fetch(`${API_BASE}/track/${encodeURIComponent(id)}`, { method: 'POST' })
    .then(r => r.ok ? r.json() : null)
    .then(data => {
      // í™”ë©´ ìˆ«ì ì¦‰ì‹œ ì˜¬ë¦¬ê¸°
      const it = state.items.find(x => x.id === id);
      if (it) {
        it.downloads = data?.downloads ?? ((it.downloads || 0) + 1);
        render(); // ì¹´ë“œ ë‹¤ì‹œ ê·¸ë¦¼
      }
    })
    .catch(() => {}) // ì‹¤íŒ¨í•´ë„ ë‹¤ìš´ë¡œë“œëŠ” ì§„í–‰
    .finally(() => {
      window.open(a.href, '_blank', 'noopener');
    });
});

  function card(i){
    const c = document.createElement('article');
    c.className = 'card';
    c.innerHTML = `
      <div class="thumb"></div>
      <div class="body">
        <h3 class="title">${i.title}</h3>
        <div class="meta"><span class="pill">${new Date(i.createdAt||Date.now()).toLocaleDateString('ko-KR')}</span><span class="pill">ë‹¤ìš´ë¡œë“œ ${fmt(i.downloads)}</span></div>
        <p style="margin:8px 0;color:var(--muted);font-size:14px;line-height:1.5">${i.desc||''}</p>
        <div class="tags">${(i.tags||[]).map(t=>`<span class='tag'>#${t}</span>`).join('')}</div>
        <div class="actions">
          ${i.url?`<a class="btn primary" data-id="${i.id}" href="${i.url}" target="_blank" rel="noopener">ë‹¤ìš´ë¡œë“œ</a>`:''}
          ${i.live?`<a class="btn" href="${i.live}" target="_blank" rel="noopener">ë°”ë¡œ ì‚¬ìš©</a>`:''}
        </div>
      </div>`;
    // ì¸ë„¤ì¼(cover) ì§€ì •
    if (i.cover) {
      c.querySelector(".thumb").style.backgroundImage = `url('${i.cover}')`;
      c.querySelector(".thumb").style.backgroundSize = "cover";
      c.querySelector(".thumb").style.backgroundPosition = "center";
    }
    return c;
  }

  document.addEventListener('input', e=>{ if(e.target.id==='q') render(); });
  document.addEventListener('change', e=>{ if(e.target.id==='sort') render(); });
  $('#randomBtn')?.addEventListener('click', ()=>{
    const arr = state.items; if(!arr.length) return;
    const r = arr[Math.floor(Math.random()*arr.length)];
    const top = ({models:'#models', utils:'#utils', music:'#music', art:'#art'})[r.category] || '#utils';
    location.hash = top;
  });

  $('#year').textContent = new Date().getFullYear();
  (async()=>{ await loadItems(); render(); })();
  </script>
</body>
</html>
