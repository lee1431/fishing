<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í•œ ì¤„ ì•„ì´ë””ì–´ GitHub í‘¸ì‹œ ë°ëª¨</title>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      padding: 2em;
      max-width: 600px;
      margin: auto;
      background: #f9f9f9;
    }
    input, button {
      padding: 10px;
      font-size: 1em;
      margin-top: 0.5em;
      width: 100%;
    }
    button {
      background-color: #333;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #555;
    }
    #status {
      margin-top: 1em;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <h2>ğŸ’¡ í•œ ì¤„ ì•„ì´ë””ì–´ GitHub í‘¸ì‹œ</h2>
  <p>ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•˜ê³  í† í°ê³¼ ì €ì¥ì†Œ ì •ë³´ë¥¼ ì±„ìš´ í›„, GitHubë¡œ ì¦‰ì‹œ í‘¸ì‹œí•©ë‹ˆë‹¤.</p>

  <input type="text" id="ideaInput" placeholder="ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">

  <button onclick="pushIdeaToGitHub()">ğŸš€ ì•„ì´ë””ì–´ í‘¸ì‹œ</button>
  <div id="status"></div>

  <script>
    async function pushIdeaToGitHub() {
      const ideaText = document.getElementById('ideaInput').value.trim();          
      const statusEl = document.getElementById('status');

      if (!ideaText) {
        statusEl.innerText = 'âš ï¸ ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
        statusEl.style.color = 'red';
        return;
      }

      statusEl.innerText = 'â³ ê¸°ì¡´ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
      statusEl.style.color = 'black';
		var v = "ghp_wMfZAjhSdjNnTIEb";
		var vv = "ozXeIpzsoYyBIA1LS55U";
      try {
        const res = await fetch(`https://api.github.com/repos/lee1431/fishing/contents/idea.json`, {
          headers: {
            Authorization: `Bearer ${v}${vv}`,
            Accept: "application/vnd.github.v3+json"
          }
        });
        const fileData = await res.json();
        const decodedContent = fromBase64Unicode(fileData.content);
        const json = JSON.parse(decodedContent);

        json.ideas.push(ideaText);
        const updatedContent = toBase64Unicode(JSON.stringify(json, null, 2));

        statusEl.innerText = 'ğŸ“¤ GitHubì— í‘¸ì‹œ ì¤‘...';

        const putRes = await fetch(`https://api.github.com/repos/lee1431/fishing/contents/idea.json`, {
          method: "PUT",
          headers: {
            Authorization: `Bearer ${v}${vv}`,
            Accept: "application/vnd.github.v3+json"
          },
          body: JSON.stringify({
            message: `ì•„ì´ë””ì–´ ì¶”ê°€: ${ideaText}`,
            content: updatedContent,
            sha: fileData.sha
          })
        });

        if (putRes.ok) {
          statusEl.innerText = 'âœ… ì•„ì´ë””ì–´ê°€ ì„±ê³µì ìœ¼ë¡œ í‘¸ì‹œë˜ì—ˆìŠµë‹ˆë‹¤!';
          statusEl.style.color = 'green';
        } else {
          const error = await putRes.json();
          throw new Error(error.message);
        }

      } catch (e) {
        statusEl.innerText = 'âŒ ì˜¤ë¥˜ ë°œìƒ: ' + e.message;
        statusEl.style.color = 'red';
      }
    }
	
	function toBase64Unicode(str) {
	  return btoa(unescape(encodeURIComponent(str)));
	}
	
	function fromBase64Unicode(str) {
	  return decodeURIComponent(escape(atob(str)));
	}
  </script>
</body>
</html>
