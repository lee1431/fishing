<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì¸ê³  â€” JSON ì–´íœë“œ ì—ë””í„°</title>
  <style>
    :root{
      --bg:#0c0b0a; --panel:#15120f; --muted:#c4bdb3; --text:#f7f2e8; --brand:#ffcf6e; --ok:#a9e86e; --bad:#ff8a7a;
      --line:#3a3127; --ink:#2b2620;
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:0 0 12px;font-size:22px}
    .row{display:grid;grid-template-columns:2fr 1fr;gap:16px}
    @media(max-width:900px){.row{grid-template-columns:1fr}}
    .card{border:2px solid var(--line);border-radius:14px;background:linear-gradient(180deg,#201b16,#15110e);box-shadow:0 4px 0 #0a0908}
    .card header{padding:10px 12px;border-bottom:2px solid var(--line);background:#1e1914;border-radius:12px 12px 0 0}
    .card .body{padding:12px}
    label{display:block;font-size:12px;color:var(--muted);margin:8px 0 4px}
    input, select, textarea{width:100%;background:#0e0d0b;color:var(--text);border:2px solid var(--line);border-radius:8px;padding:10px}
    textarea{min-height:90px;resize:vertical}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btns{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    button{border:2px solid var(--line);border-radius:10px;padding:10px 12px;background:#15110e;color:var(--text);cursor:pointer;box-shadow:0 3px 0 #0a0908}
    button.primary{background:linear-gradient(180deg,#2a231c,#1a1511)}
    .muted{color:var(--muted)}
    .log{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;font-size:12px;background:#0b0a08;color:#dcd6cc;padding:10px;border-radius:8px;border:1px dashed var(--line);max-height:240px;overflow:auto}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:#2b231b;border:1px solid var(--line);font-size:12px;color:#f1e6d3}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #2b241c;padding:8px;text-align:left;font-size:13px}
    .right{float:right}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ§° ì¸ê³  â€” JSON ì–´íœë“œ ì—ë””í„° <span class="pill">admin.html</span></h1>
    <p class="muted">`ingo-items.json`ì„ ë¶ˆëŸ¬ì™€ <b>ìƒˆ í•­ëª©ì„ ì¶”ê°€</b>í•˜ê³ , ìˆ˜ì •ëœ JSONì„ <b>íŒŒì¼ë¡œ ì €ì¥</b>í•˜ê±°ë‚˜ <b>ì„œë²„ë¡œ POST</b>í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

    <div class="row">
      <div class="card">
        <header>
          <strong>1) í•­ëª© ì…ë ¥</strong>
          <button id="genId" class="right">ID ìë™ìƒì„±</button>
        </header>
        <div class="body">
          <div class="grid2">
            <div>
              <label>id (ê³ ìœ )</label>
              <input id="id" placeholder="ì˜ˆ: json-diff" />
            </div>
            <div>
              <label>category</label>
              <select id="category">
                <option value="models">models</option>
                <option value="utils" selected>utils</option>
                <option value="music">music</option>
                <option value="art">art</option>
              </select>
            </div>
          </div>
          <label>title</label>
          <input id="title" placeholder="ì˜ˆ: JSON ì‹œê° Diff ë·°ì–´" />
          <label>desc</label>
          <textarea id="desc" placeholder="ê°„ë‹¨ ì„¤ëª…"></textarea>

          <div class="grid2">
            <div>
              <label>tags (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
              <input id="tags" placeholder="ì˜ˆ: ì›¹íˆ´, JSON, ê°œë°œ" />
            </div>
            <div>
              <label>createdAt (YYYY-MM-DD)</label>
              <input id="createdAt" placeholder="ì˜ˆ: 2025-08-16" />
            </div>
          </div>
          <div class="grid2">
            <div>
              <label>downloads (ìˆ«ì)</label>
              <input id="downloads" type="number" min="0" value="0" />
            </div>
            <div>
              <label>score (ìˆ«ì)</label>
              <input id="score" type="number" min="0" value="0" />
            </div>
          </div>
          <div class="grid2">
            <div>
              <label>url (ë‹¤ìš´ë¡œë“œ ë§í¬)</label>
              <input id="url" placeholder="https://..." />
            </div>
            <div>
              <label>live (ì›¹ ì‹¤í–‰ ë§í¬)</label>
              <input id="live" placeholder="https://..." />
            </div>
          </div>
          <label>cover (ì¸ë„¤ì¼ URL) â€” ì„ íƒ</label>
          <input id="cover" placeholder="https://.../thumb.png" />
          <label>changelog (ì¤„ë°”ê¿ˆìœ¼ë¡œ êµ¬ë¶„)</label>
          <textarea id="changelog" placeholder="v1.0 â€” ê³µê°œ&#10;v1.1 â€” ë²„ê·¸ ìˆ˜ì •"></textarea>

          <div class="btns">
            <button id="add" class="primary">ëª©ë¡ì— ì¶”ê°€í•˜ê¸°</button>
            <button id="reset">ì…ë ¥ ì´ˆê¸°í™”</button>
          </div>
        </div>
      </div>

      <div class="card">
        <header><strong>2) í˜„ì¬ JSON ìƒíƒœ</strong></header>
        <div class="body">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px">
            <div>
              <span class="pill">ë¡œë“œ: <span id="loadStatus">ëŒ€ê¸°</span></span>
            </div>
            <div class="btns" style="margin:0">
              <button id="load">ingo-items.json ë¶ˆëŸ¬ì˜¤ê¸°</button>
              <button id="download" class="primary">ìˆ˜ì •ë³¸ ì €ì¥(.json)</button>
            </div>
          </div>
          <div class="log" id="jsonPreview" aria-label="JSON ë¯¸ë¦¬ë³´ê¸°"></div>
          <p class="muted" style="margin-top:10px">ì„œë²„ ì €ì¥ì„ ì“°ë ¤ë©´ ì•„ë˜ ì„¤ì •ì„ ì±„ìš°ì„¸ìš”.</p>
          <label>ì„œë²„ ì €ì¥ URL (POST)</label>
          <input id="saveUrl" placeholder="ì˜ˆ: /admin/save-items" />
          <div class="grid2">
            <div>
              <label>ì¸ì¦ í† í° í—¤ë” ì´ë¦„</label>
              <input id="tokenHeader" placeholder="ì˜ˆ: X-Admin-Token" value="X-Admin-Token" />
            </div>
            <div>
              <label>ì¸ì¦ í† í° ê°’</label>
              <input id="tokenValue" placeholder="ì„œë²„ ë¹„ë°€ í† í°" />
            </div>
          </div>
          <div class="btns">
            <button id="postServer">ì„œë²„ë¡œ ì €ì¥(POST)</button>
          </div>
          <div class="log" id="log"></div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <header><strong>3) ëª©ë¡(ê°„ì´ í…Œì´ë¸”)</strong></header>
      <div class="body">
        <table id="tbl">
          <thead><tr><th>id</th><th>title</th><th>category</th><th>createdAt</th><th>actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    const $ = (s,el=document)=> el.querySelector(s);
    const $$ = (s,el=document)=> [...el.querySelectorAll(s)];
    const log = (m, cls='')=>{ const l=$('#log'); l.innerHTML += `<div class="${cls}">${m}</div>`; l.scrollTop=l.scrollHeight; };

    let items = [];

    function slugify(s){
      return (s||'')
        .toString().trim().toLowerCase()
        .replace(/[^a-z0-9ê°€-í£-_\s]/g,'')
        .replace(/\s+/g,'-')
        .replace(/-+/g,'-')
        .replace(/^-|-$/g,'');
    }

    function readForm(){
      const id = $('#id').value.trim();
      const title = $('#title').value.trim();
      const category = $('#category').value;
      const desc = $('#desc').value.trim();
      const tags = $('#tags').value.split(',').map(s=>s.trim()).filter(Boolean);
      const createdAt = $('#createdAt').value.trim();
      const downloads = +($('#downloads').value||0);
      const score = +($('#score').value||0);
      const url = $('#url').value.trim();
      const live = $('#live').value.trim();
      const cover = $('#cover').value.trim();
      const changelog = $('#changelog').value.split('\n').map(s=>s.trim()).filter(Boolean);
      return {id,title,category,desc,tags,createdAt,downloads,score,url,live,cover,changelog};
    }

    function validate(it){
      if(!it.id) return 'idê°€ í•„ìš”í•©ë‹ˆë‹¤';
      if(!it.title) return 'titleì´ í•„ìš”í•©ë‹ˆë‹¤';
      if(!it.category) return 'categoryê°€ í•„ìš”í•©ë‹ˆë‹¤';
      if(items.some(x=>x.id===it.id)) return 'ê°™ì€ idê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤';
      return '';
    }

    function refreshPreview(){
      $('#jsonPreview').textContent = JSON.stringify(items, null, 2);
      const tbody = $('#tbl tbody');
      tbody.innerHTML = items.map(x=>`
        <tr>
          <td>${x.id}</td>
          <td>${x.title}</td>
          <td>${x.category}</td>
          <td>${x.createdAt||''}</td>
          <td>
            <button data-act="del" data-id="${x.id}">ì‚­ì œ</button>
          </td>
        </tr>`).join('');
    }

    function addItem(){
      const it = readForm();
      const err = validate(it);
      if(err){ log(`âŒ ${err}`,'bad'); return; }
      items.push(it);
      refreshPreview();
      log(`âœ… ì¶”ê°€ë¨: ${it.id}`,'ok');
    }

    async function loadJson(){
      const candidates = ['ingo-items.json','/ingo-items.json'];
      for(const u of candidates){
        try{ const r = await fetch(u,{cache:'no-store'}); if(r.ok){ items = await r.json(); $('#loadStatus').textContent = `ë¡œë“œ ì™„ë£Œ (${u})`; refreshPreview(); return; } }catch(e){}
      }
      $('#loadStatus').textContent = 'ì°¾ì§€ ëª»í•¨ â€” ë¹ˆ ëª©ë¡ ì‹œì‘';
      items = []; refreshPreview();
    }

    function downloadJson(){
      const blob = new Blob([JSON.stringify(items,null,2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'ingo-items.json';
      a.click(); URL.revokeObjectURL(a.href);
      log('ğŸ’¾ íŒŒì¼ë¡œ ì €ì¥ ì™„ë£Œ','ok');
    }

    async function postServer(){
      const url = $('#saveUrl').value.trim();
      if(!url){ log('ì„œë²„ ì €ì¥ URLì„ ì…ë ¥í•˜ì„¸ìš”','bad'); return; }
      const hdr = $('#tokenHeader').value.trim()||'X-Admin-Token';
      const tok = $('#tokenValue').value.trim();
      try{
        const r = await fetch(url, {method:'POST', headers:{'Content-Type':'application/json', [hdr]:tok}, body: JSON.stringify({items})});
        const txt = await r.text();
        if(!r.ok) throw new Error(txt||r.status);
        log(`ğŸ“¡ ì„œë²„ ì €ì¥ ì„±ê³µ: ${txt}`,'ok');
      }catch(e){ log(`ì„œë²„ ì €ì¥ ì‹¤íŒ¨: ${e.message}`,'bad'); }
    }

    // events
    $('#genId').onclick = ()=>{ const s = slugify($('#title').value || $('#desc').value); $('#id').value = s || `item-${Date.now()}`; };
    $('#add').onclick = addItem;
    $('#reset').onclick = ()=> $$('input,textarea').forEach(el=>{ if(el.id!=='downloads'&&el.id!=='score') el.value=''; });
    $('#load').onclick = loadJson;
    $('#download').onclick = downloadJson;
    $('#postServer').onclick = postServer;
    $('#tbl').addEventListener('click', e=>{
      const b = e.target.closest('button[data-act="del"]');
      if(!b) return;
      const id = b.getAttribute('data-id');
      items = items.filter(x=>x.id!==id); refreshPreview(); log(`ğŸ—‘ï¸ ì‚­ì œë¨: ${id}`,'bad');
    });

    // ì´ˆê¸° ìƒíƒœ
    refreshPreview();
  </script>
</body>
</html>
